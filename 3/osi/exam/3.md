# Организация прерываний, типы прерываний, контроллер прерываний.

# Прерывания в компьютерных системах

Прерывания — это механизм, позволяющий процессору **прервать** текущее выполнение программы и передать управление **обработчику**, когда возникает важное (или критическое) событие.

## Основные особенности
- **Выполняются в конце цикла команды**: процессор завершает текущую команду, проверяет сигналы прерываний и, если они есть, переключается на обработчик.
- **Могут быть вложенными**: пока выполняется обработчик одного прерывания, может возникнуть прерывание более высокого приоритета.
- **Приоритеты**: разные типы прерываний имеют разный приоритет (например, ошибки аппаратуры, таймер, ввод-вывод, и т. д.). Высокоприоритетные прерывания обрабатываются прежде низкоприоритетных.

---

## Типы прерываний

### 1. Синхронные
Возникают *в результате выполнения* команды процессора:
- **Syscalls (системные вызовы)**: когда пользовательский процесс добровольно вызывает «trap» для перехода в ядро.
- **Pagefaults**: при обращении к странице, не загруженной в память.
- **Ошибки**: деление на 0, недопустимая инструкция, нарушение привилегий, FP-исключения и др.

### 2. Асинхронные
Приходят *извне* или по таймеру, не зависят от текущей инструкции:
- **IO Interrupts**: сигнал от устройства ввода-вывода (закончена операция).
- **Timer**: периодические прерывания (тактовый таймер).
- **Kernel events**: планировочные события (preemption), сигналы (signals), сбои питания, ошибки шины и т. д.

---

## Организация и контроллер прерываний (x86/x64)

В контроллере прерываний есть несколько процессоров. У каждого процессора свой
локальный маршрутизатор/контроллер прерываний, обработчик прерываний. Есть
устройства IO, посылающие запрос на прерывание, логика, занимающаяся
обработкой, отвечающая за приоритеты и прочее, локальный контроллер посылает
процессору запрос на прерывание

### Обработка прерывания
1. **Сохраняется** состояние (регистры, флаги) текущего процесса.
2. Процессор переключается в привилегированный режим (Ring 0), выполняет код **обработчика прерывания**.
3. Обработчик выполняет нужные действия (прочитать статус устройства, обновить буферы, «разбудить» ожидающий процесс).
4. **Возврат** к прерванному коду — восстанавливаются регистры, продолжается прежняя программа.



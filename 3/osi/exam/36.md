# Примитивы синхронизации ОС. Условные перменные, rwlocks.

```
Условные переменные позволяют потокам ждать наступления определенного условия, освобождая при этом мьютекс. Когда условие выполняется, другой поток сигнализирует потоку или оповещает все потоки, ождившие на условной переменной, и они возобновляют работу вновь захватывая мьютекс.
```

### Ключевые операции
1. wait(condition, lock):
   * Поток которвый вызывает wait должен уже владеть lock
   * При выполнении wait поток временно освобождает lock и переходит в состояние ожидания на condition
   * Как только он просыпается на signal или broadcast поток снова пытается захватить lock и продолжает с места где остановился
2. signal(condition. lock)
   * Пробуждает один поток ожидающий на condition
3. broadcast(condition, lock)
   * Пробуждает сразу все потоки, ожидающие на condition

Используется в Producer/Customer шаблоне.

## Rwlocks - множество читателей, один писатель

```
Основная идея - несколько потоков могут одновременно читать общий ресус, но запись может выполнять только один поток в единицу времени, причем без единовроменного чтения. 
```
* Когда читатель хочет читать, он запрашивает readlock
* Если в данный момент нет активного писателя, читатель получает доступ к ресурсу
* Счетчик читателей внутри rwlock увеличивается
* Когда писатель хочет писать он устанавливает запрос на запись и ждет освобождения ресурса (пока нет активных читателей и писателей)
* Как только rwlock == 0 писатель захватывает writelock
* По завершении записи освобождает writelock и оповещает ждущих читателей
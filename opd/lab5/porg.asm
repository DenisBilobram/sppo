ORG 0x100

ONEP: word 0x101
ONE: word 0x0020, 0x0040, 0x00FF, 0x0000

TWOP: word 0x106
TWO: word 0x0047, 0x0089, 0x0091, 0x0061, 0x0000

THREEP: word 0x10C
THREE: word 0x0042, 0x0081, 0x0091, 0x006E, 0x0000

FOURP: word 0x112
FOUR: word 0x00F0, 0x0010, 0x00FF, 0x0000

FIVEP: word 0x117
FIVE: word 0x00F1, 0x0091, 0x0091, 0x009F, 0x0000

SIXP: word 0x11D
SIX: word  0x007E, 0x0089, 0x0089, 0x0046, 0x0000

SEVENP: word 0x123
SEVEN: word 0x00C0, 0x0083, 0x008C, 0x00F0, 0x0000

EIGHTP: word 0x129
EIGHT: word 0x006E, 0x0091, 0x0091, 0x006E, 0x0000

NINEP: word 0x12F
NINE: word 0x0062, 0x0091, 0x0091, 0x007E, 0x0000

AP: word 0x135
A: word 0x007F, 0x0090, 0x0090, 0x007F, 0x0000

BP: word 0x13B
B: word 0x00FF, 0x0091, 0x0091, 0x007E, 0x0000

CP: word 0x141
C: word 0x007E, 0x0081, 0x0081, 0x0042, 0x0000

DP: word 0x147
D: word 0x00FF, 0x0081, 0x0081, 0x007E, 0x0000

EP: word 0x14D
E: word 0x00FF, 0x0091, 0x0091, 0x0091, 0x0000

FP: word 0x153
F: word 0x00FF, 0x0090, 0x0090, 0x0090, 0x0000

ZEROP: word 0x159
ZERO:  word 0x00FF, 0x0081, 0x0081, 0x00FF, 0x0000

LEFAND: word 0xF000
LEF0: word 0x0000
LEF1: word 0x1000
LEF2: word 0x2000
LEF3: word 0x3000
LEF4: word 0x4000
LEF5: word 0x5000
LEF6: word 0x6000
LEF7: word 0x7000
LEF8: word 0x8000
LEF9: word 0x9000
LEFA: word 0xA000
LEFB: word 0xB000
LEFC: word 0xC000
LEFD: word 0xD000
LEFE: word 0xE000
LEFF: word 0xF000


POINTER: word $ZEROP
NEG_SIGN: word 0x1000
VALUE: word 0x0000
NUL: word 0x0000
COLUMNS: word 32
DIGITNUM: word 0x0001

START: CLA
PUSH
JUMP DROW

READY: IN 0x1D
AND #0x40
BEQ READY
IN 0x1C

UPDATE:
PUSH
LD #0x01
ST $DIGITNUM
CALL CLEAR
POP
CMP #0x00
BEQ MAKENULL
CMP #0x0B
BEQ PLUS
CMP #0x0A
BEQ MINUS


DROW:
LD $DIGITNUM
CMP #0x01
BEQ AFTERMULT
MULT:
POP
ASL
ASL
ASL
ASL
PUSH
AFTERMULT: POP
PUSH
LD $DIGITNUM
INC
ST DIGITNUM
POP
CALL GETPOINTER
PUSH
CALL DROWDIGIT
LD DIGITNUM
CMP #5
BNE DROW
JUMP READY

CLEAR: LD NUL
OUT 0x10
LOOP COLUMNS
JUMP CLEAR
LD #32
ST $COLUMNS
RET

PLUS:
LD $VALUE
INC
ST $VALUE
PUSH
JUMP CHECKNEG

MINUS:
LD $VALUE
DEC
ST $VALUE
PUSH
JUMP CHECKNEG

MAKENULL:
CLA
ST $VALUE
PUSH
JUMP DROW

CHECKNEG:
AND $NEG_SIGN
BEQ DROW
CALL DROWMINUS
POP
NEG
PUSH
JUMP DROW

DROWDIGIT:
GETEL: LD (POINTER)+
OUT 0x10
BNE GETEL
RET

DROWMINUS: LD #0x10
OUT 0x10
OUT 0x10
OUT 0x10
CLA
OUT 0x10
RET

GETPOINTER:
PUSH
AND $LEFAND
CHECK0: CMP $LEF0
BNE CHECK1
LD $ZEROP
ST $POINTER
POP
RET

CHECK1: CMP $LEF1
BNE CHECK2
LD $ONEP
ST $POINTER
POP
RET

CHECK2: CMP $LEF2
BNE CHECK3
LD $TWOP
ST $POINTER
POP
RET

CHECK3: CMP $LEF3
BNE CHECK4
LD $THREEP
ST $POINTER
POP
RET

CHECK4: CMP $LEF4
BNE CHECK5
LD $FOURP
ST $POINTER
POP
RET

CHECK5: CMP $LEF5
BNE CHECK6
LD $FIVEP
ST $POINTER
POP
RET

CHECK6: CMP $LEF6
BNE CHECK7
LD $SIXP
ST $POINTER
POP
RET

CHECK7: CMP $LEF7
BNE CHECK8
LD $SEVENP
ST $POINTER
POP
RET

CHECK8: CMP $LEF8
BNE CHECK9
LD $EIGHTP
ST $POINTER
POP
RET

CHECK9: CMP $LEF9
BNE CHECKA
LD $NINEP
ST $POINTER
POP
RET

CHECKA: CMP $LEFA
BNE CHECKB
LD $AP
ST $POINTER
POP
RET

CHECKB: CMP $LEFB
BNE CHECKC
LD $BP
ST $POINTER
POP
RET

CHECKC: CMP $LEFC
BNE CHECKD
LD $CP
ST $POINTER
POP
RET

CHECKD: CMP $LEFD
BNE CHECKE
LD $DP
ST $POINTER
POP
RET

CHECKE: CMP $LEFE
BNE CHECKF
LD $EP
ST $POINTER
POP
RET

CHECKF: CMP $LEFF
LD $FP
ST $POINTER
POP
RET

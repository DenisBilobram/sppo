	ORG 0x0
V0:	WORD $DEFAULT, 0x180
V1:	WORD $INTERRVU1, 0x180
V2:	WORD $INTERRVU2, 0x180

	ORG 0x013
X: 	word 0x0000
XP: word $X
XMAX: 	word 0xFF80
DEREF:	word ?

START:	DI
	LD #0x09
	OUT 0x3
	LD #0x0A
	OUT 0x5
	EI

PROG:	PUSH
	PUSH
	LD $X
	ST &0
	SUB #0x3
	CALL CHECKODZ
	ST &1
	LD XP
	PUSH
	CALL CAS
	JUMP PROG

CAS:	PUSHF
	DI
	LD &2
	ST DEREF
	LD (DEREF)
	CMP &3
	BEQ THEN
	JUMP ELSE
THEN:	LD &4
	ST (DEREF)
	LD #1
	JUMP EXIT
ELSE:	CLA
	JUMP EXIT
EXIT:	POPF
	SWAP
	ST &3
	SWAP
	SWAP
	POP
	SWAP
	POP
	SWAP
	POP
	RET

CHECKODZ:	CMP $XMAX
	BLT DOXMAX
	RET
DOXMAX:	LD $XMAX
	RET	

DEFAULT:	IRET

INTERRVU1:	PUSH
	LD $X
CALCFX: 	SUB $X
	SUB $X
	SUB $X
AFTERINV: 	ADD #0x4
	OUT 0x2
	POP
	IRET

	ORG 0x200
XORRES: 	word 0x0000
XORMASK: 	word 0x0080
XORMASKCONST: word 0x0080
LOOPCOUNT:	word 0x0009
TMP:	word ?
XMASK: 	word ?

INTERRVU2:	PUSH
	IN 0x4
	ST TMP
XORLOOP:	LOOP LOOPCOUNT
	JUMP XORING
AFTERXOR:	LD $XORRES
	SXTB
	ST $X
	CLA
	ST $XORRES
	LD #0x09
	ST $LOOPCOUNT
    LD $XORMASKCONST
	ST $XORMASK
	POP
	IRET

XORING:	LD $X
	AND $XORMASK
	ST $XMASK
	LD $TMP
	AND $XORMASK
	ADD $XMASK
	AND $XORMASK
	ADD $XORRES
	ST $XORRES
	LD $XORMASK
	ASR
	ST $XORMASK
	JUMP XORLOOP